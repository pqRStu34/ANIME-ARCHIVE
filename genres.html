<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Genres - Anime Streaming Testsite</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5403590533015775"
    crossorigin="anonymous"></script>
  <style>
    body {
      font-family: 'Ubuntu', sans-serif;
      background: #14161a;
    }

    .navbar-sticky {
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .genre-card,
    .year-card {
      border-radius: 12px;
      /* Removed box-shadow and border */
      margin-bottom: 1.5rem;
      padding: 1.2rem 1rem;
      background: #14161a;
      box-shadow: none;
      border: none;
      color: #ff6685;
    }

    .badge-genre {
      border-radius: 4px !important;
      background: #2e333d !important;
      color: #fff !important;
    }

    .genre-card .bi,
    .year-card .bi {
      color: #ff6685;
    }

    .badge-genre.selected,
    .badge-year.selected {
      background: #198754 !important;
      color: #fff !important;
    }

    .badge-genre.discarded {
      background: #dc3545 !important;
      color: #fff !important;
    }

    .badge-year {
      background: #66d1ff !important;
      color: #14161a !important;
      transition: background 0.2s, color 0.2s;
    }

    .badge-year.selected {
      background: #66d1ff !important;
      color: #4258ff !important;
      font-weight: 700;
    }

    .advanced-search-card {
      border-radius: 12px;
      /* Removed box-shadow and border */
      margin-bottom: 2rem;
      padding: 1.5rem 1rem;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
      overflow: hidden;
      max-height: 1000px;
      opacity: 1;
      background: #16181d;
      box-shadow: none;
      border: none;
    }

    .advanced-search-card.collapsed {
      /* Completely remove collapsed state so it never applies */
      display: block !important;
      max-height: 1000px !important;
      opacity: 1 !important;
      padding-top: 1.5rem !important;
      padding-bottom: 1rem !important;
      margin-bottom: 2rem !important;
    }

    .advanced-search-btn {
      background: #48c78e !important;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.5em 1.5em;
      font-weight: 700;
      margin-top: 1em;
      box-shadow: 0 0 8px #198754;
      transition: background 0.2s, color 0.2s;
    }

    .advanced-search-btn:hover {
      background: #36a86c !important;
      color: #fff !important;
    }

    .adv-search-toggle {
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
      font-size: 1.2em;
      font-weight: 700;
      color: #0d6efd;
      margin-bottom: 1rem;
      transition: color 0.2s;
    }

    .adv-search-toggle .bi {
      margin-right: 0.5em;
      font-size: 1.5em;
    }

    .search-results {
      margin-top: 2rem;
    }

    .search-results .card {
      border-radius: 10px;
      margin-bottom: 1em;
      /* Removed box-shadow and border */
      box-shadow: none;
      border: none;
    }


    .advanced-search-card label,
    .advanced-search-card .form-label,
    .advanced-search-card .bi {
      color: #ffb70f !important;
    }

    #adv-search-toggle {
      color: #ffb70f !important;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 100%;
    }

    #adv-search-toggle .bi {
      color: #ffb70f !important;
    }

    .advanced-search-card .bi,
    #adv-search-toggle .bi {
      color: #00d1b2 !important;
    }
  </style>
</head>

<body>
  <section class="container py-5">
    <div id="advanced-search-card" class="advanced-search-card">
      <div class="mb-3">
        <label class="form-label text-primary">Select Genres</label>
        <div id="adv-genre-tags" class="d-flex flex-wrap gap-2"></div>
      </div>
      <div class="mb-3">
        <label class="form-label text-primary">Select Year</label>
        <div id="adv-year-tags" class="d-flex flex-wrap gap-2"></div>
      </div>
      <button id="advanced-search-btn" class="advanced-search-btn btn btn-success">
        Search
      </button>
    </div>

    <!-- Genre Tags Card -->
    <div class="genre-card card mb-4">
      <div class="card-body">
        <h2 class="card-title h6 mb-2">
          <i class="bi bi-tags"></i> Genres
        </h2>
        <div id="genre-tags" class="d-flex flex-wrap gap-2"></div>
      </div>
    </div>

    <!-- Year Tags Card -->
    <div class="year-card card mb-4">
      <div class="card-body">
        <h2 class="card-title h6 mb-2">
          <i class="bi bi-calendar-event"></i> Years
        </h2>
        <div id="year-tags" class="d-flex flex-wrap gap-2"></div>
      </div>
    </div>

    <!-- Search Results -->
    <div id="search-results" class="search-results"></div>
  </section>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const genres = [
      "Romance",
      "Comedy",
      "Action",
      "Adventure",
      "Drama",
      "Fantasy",
      "Sci-Fi",
      "Slice of Life",
      "Horror",
      "Mystery",
      "Supernatural",
      "Sports",
      "Thriller",
      "Historical",
    ];
    const years = [
      "2024",
      "2023",
      "2022",
      "2021",
      "2020",
      "2019",
      "2018",
      "2017",
      "2016",
      "2015",
    ];

    let seriesList = [];
    let activeGenre = null;
    let activeYear = null;

    const genreTags = document.getElementById("genre-tags");
    const genreTagsSkeleton = document.getElementById("genre-tags-skeleton");
    const yearTags = document.getElementById("year-tags");
    const yearTagsSkeleton = document.getElementById("year-tags-skeleton");
    const advSearchCard = document.getElementById("advanced-search-card");
    const advSearchSkeleton = document.getElementById("adv-search-skeleton");
    const searchResults = document.getElementById("search-results");
    const searchResultsSkeleton = document.getElementById(
      "search-results-skeleton"
    );

    fetch("serieslist.json")
      .then((res) => res.json())
      .then((list) => {
        seriesList = list;
        // Hide skeletons, show real UI
        genreTags.style.display = "";
        yearTags.style.display = "";
        advSearchCard.style.display = "";
        searchResults.style.display = "";
        renderTags("genre-tags", genres, "badge-genre", onGenreTagClick);
        renderTags("year-tags", years, "badge-year", onYearTagClick);
        renderTags("adv-genre-tags", genres, "badge-genre", toggleAdvGenre);
        renderTags("adv-year-tags", years, "badge-year", toggleAdvYear);
        renderResults([]); // Show nothing by default
      });

    // --- Genre/Year tag click for quick filter (toggle) ---
    function onGenreTagClick(tag, el) {
      // Reset year selection
      activeYear = null;
      document
        .querySelectorAll("#year-tags .badge-year")
        .forEach((e) => e.classList.remove("selected"));
      // Toggle genre selection
      if (activeGenre === tag) {
        activeGenre = null;
        el.classList.remove("selected");
        renderResults([]); // Show nothing if nothing selected
      } else {
        activeGenre = tag;
        document
          .querySelectorAll("#genre-tags .badge-genre")
          .forEach((e) => e.classList.remove("selected"));
        el.classList.add("selected");
        renderResults(
          seriesList.filter(
            (s) => Array.isArray(s.genres) && s.genres.includes(tag)
          )
        );
      }
    }
    function onYearTagClick(tag, el) {
      // Reset genre selection
      activeGenre = null;
      document
        .querySelectorAll("#genre-tags .badge-genre")
        .forEach((e) => e.classList.remove("selected"));
      // Toggle year selection
      if (activeYear === tag) {
        activeYear = null;
        el.classList.remove("selected");
        renderResults([]); // Show nothing if nothing selected
      } else {
        activeYear = tag;
        document
          .querySelectorAll("#year-tags .badge-year")
          .forEach((e) => e.classList.remove("selected"));
        el.classList.add("selected");
        renderResults(seriesList.filter((s) => s.year === tag));
      }
    }

    // --- Advanced search state ---
    let advSelectedGenres = {};
    let advSelectedYear = null;

    // --- Advanced search genre tag: click toggles between selected, discarded, and neutral ---
    function toggleAdvGenre(tag, el) {
      if (!advSelectedGenres[tag]) {
        advSelectedGenres[tag] = "selected";
        el.classList.add("selected");
        el.classList.remove("discarded");
      } else if (advSelectedGenres[tag] === "selected") {
        advSelectedGenres[tag] = "discarded";
        el.classList.remove("selected");
        el.classList.add("discarded");
      } else {
        delete advSelectedGenres[tag];
        el.classList.remove("selected", "discarded");
      }
    }

    // --- Advanced search year tag: toggle select/unselect ---
    function toggleAdvYear(tag, el) {
      if (advSelectedYear === tag) {
        advSelectedYear = null;
        el.classList.remove("selected");
      } else {
        advSelectedYear = tag;
        document
          .querySelectorAll("#adv-year-tags .badge-year")
          .forEach((e) => e.classList.remove("selected"));
        el.classList.add("selected");
      }
    }

    // --- Render tags utility ---
    function renderTags(containerId, tagList, badgeClass, selectCallback) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      tagList.forEach((tag) => {
        const isGenre = badgeClass.includes('badge-genre');
        const pillClass = isGenre ? '' : 'rounded-pill';
        const el = document.createElement("span");
        el.className = `badge bg-secondary ${badgeClass} ${pillClass} me-2 mb-2`;
        el.textContent = tag;
        el.style.cursor = "pointer";
        el.addEventListener("click", () => selectCallback(tag, el));
        container.appendChild(el);
      });
    }

    // --- Render results ---
    function renderResults(results) {
      const container = document.getElementById("search-results");
      if (!results.length) {
        container.innerHTML = "";
        return;
      }
      container.innerHTML = results
        .map(
          (s) => `
        <div class="card mb-3" style="background:#14161a; color:#fff;">
          <div class="row g-0 align-items-center">
            <div class="col-auto">
              <img src="${s.poster || 'https://bulma.io/images/placeholders/480x640.png'}" alt="${s.title || s.name || ''}" class="img-fluid rounded-start" style="width:90px; height:130px; object-fit:cover; background:#23262c; border-radius:10px; border:2px solid #23262c;">
            </div>
            <div class="col ps-3">
              <div class="d-flex align-items-center mb-1">
                <h5 class="mb-0 me-2" style="color:#ff6685; font-weight:700;">${s.title || s.name || ''}</h5>
                <span class="badge badge-year ms-1" style="background:#66d1ff; color:${s.year ? '#4258ff' : '#14161a'}; font-weight:700;">${s.year || ''}</span>
              </div>
              <div class="mb-1">
                ${(Array.isArray(s.genres) ? s.genres : []).map(g => `<span class='badge badge-genre me-1 mb-1' style='background:#2e333d; color:#fff;'>${g}</span>`).join(' ')}
              </div>
              <div class="small text-light">${s.description ? s.description : ''}</div>
            </div>
          </div>
        </div>
      `
        )
        .join("");
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Remove the .collapsed class from the advanced search card on page load to ensure it is always open
      const advSearchCard = document.getElementById("advanced-search-card");
      if (advSearchCard && advSearchCard.classList.contains("collapsed")) {
        advSearchCard.classList.remove("collapsed");
      }
      // Only add click event for the search button, not for toggling the card
      document
        .getElementById("advanced-search-btn")
        .addEventListener("click", () => {
          // Advanced search logic
          let includeGenres = Object.keys(advSelectedGenres).filter(
            (g) => advSelectedGenres[g] === "selected"
          );
          let excludeGenres = Object.keys(advSelectedGenres).filter(
            (g) => advSelectedGenres[g] === "discarded"
          );
          let year = advSelectedYear;
          let results = seriesList.filter((s) => {
            // Include genres: must have all selected
            if (includeGenres.length && (!Array.isArray(s.genres) || !includeGenres.every((g) => s.genres.includes(g)))) {
              return false;
            }
            // Exclude genres: must not have any
            if (excludeGenres.length && Array.isArray(s.genres) && excludeGenres.some((g) => s.genres.includes(g))) {
              return false;
            }
            // Year filter
            if (year && s.year !== year) {
              return false;
            }
            return true;
          });
          renderResults(results);
          // Show message if no results
          if (!results.length) {
            let msg = document.createElement("div");
            msg.className = "alert alert-danger text-center position-fixed top-0 start-50 translate-middle-x";
            msg.textContent = "No series found for selected filters.";
            msg.style.zIndex = "9999";
            msg.style.width = "auto";
            document.body.appendChild(msg);
            setTimeout(() => {
              msg.remove();
            }, 2000);
          }
        });
    });
  </script>
</body>

</html>